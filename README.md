This repository contains Miro API client and tools needed to generate them based on OpenAPI specification.
Currently the only available client is [Node.JS client](./packages/typescript-node) written in typescript.

### OpenAPI specification

API clients are generated using `@openapitools/openapi-generator-cli`. They are generated based on the API specifications from `spec.json` file.

Running `yarn update-spec` will update the spec file. It downloads separate OpenAPI specification files and merges them into a single specification. The specification is downloaded and merged by the `./scripts/fetch-spec.mjs` script.

In the specification, each endpoint should have a unique `operationId` because client method names are derived from that.

### Generating typescript-node client

```bash
yarn generate
```

#### 1. Low level client methods

This command will run _openapi-generator-cli_ with the typescript-node generator, based on the mustache files in `templates` dir. This will generate _lowlevel_ code into `api` and `model` subdirectories.

#### 2. High level client methods & models

This command will also execute `./generator/generate_node_highlevel_models.ts` which generates _highlevel_ client models that use the _lowlevel_ client code generated using _openapi-generator-cli_. This is based on the model definitions in `./generator/modelDefinition.ts`.

Extending autogenerated models can be done by defining classes in `nested-model` directory and updating the model definition to point to the new file. See `packages/typescript-node/nested-model/Team.ts` for an example.

See [MODELS.md](./MODELS.md) file for the generated model hierarchy.

#### 3. Compiling to Javascript

As the final step the command will run `yarn build` which will compile the typescript code, generate .d.ts files and also generate documentation for the client using _typedoc_.

### Publishing

#### NPM

Contents of `packages/typescript-node` are automatically published as `@mirohq/miro-node` to NPM when the version in `package.json` is changed.

The [publish](https://github.com/miroapp/api-clients/actions/workflows/publish.yml) action is responsible for that.

#### Documentation

Documentation is automatically published to [github pages](https://miroapp.github.io/api-clients/) using the [pages-build-deployment](https://github.com/miroapp/api-clients/actions/workflows/pages/pages-build-deployment) action.
